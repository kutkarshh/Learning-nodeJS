<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Page</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <style>
      * {
        font-family: Cambria, Cochin, Georgia, Times, "Times New Roman", serif;
      }
      table,
      th,
      td {
        border: 1px solid black;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 10px;
      }
      .container {
        padding: 20px;
      }
      .table-container {
        display: flex;
        justify-content: space-between;
      }
      .table-title {
        text-align: center;
        font-weight: bold;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body class="container">
    <h1 class="text-center">Welcome to Url Shortener App</h1>

    <div class="mb-4">
      <form action="/url" method="POST">
        <div class="form-group">
          <h4 for="url">Enter Original Url:</h4>
          <input
            class="form-control"
            type="text"
            name="url"
            placeholder="https://example.com"
            required
          />
        </div>
        <div class="form-group text-center">
          <button class="btn btn-primary" type="submit">Shorten</button>
        </div>
      </form>
      <% if (locals.id) { %>
      <div class="p-2 bg-info text-white text-center">
        Shortened Url:
        <a
          href="http://localhost:8001/url/<%= id %>"
          target="_blank"
          class="text-white"
          >http://localhost:8001/url/<%= id %></a
        >
      </div>
      <% } %>
    </div>

    <% if (locals.error) { %>
    <div class="alert alert-danger">Some Error Occurred: <%= error %></div>
    <% } %> <% if (locals.deleted) { %>
    <div class="alert alert-success">
      URL Deleted Successfully! <b>id:<%= deleted %></b>
    </div>
    <% } %>

    <div class="table-container">
      <% if (locals.my_urls && locals.my_urls.length) { %>
      <div class="table-responsive mr-2">
        <div class="table-title">My URLs</div>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>S. No</th>
              <th>Short ID</th>
              <th>Redirect URL</th>
              <th>Clicks</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% my_urls.forEach((url, index) => { %>
            <tr>
              <td><%= index + 1 %></td>
              <td><%= url.shortId %></td>
              <td><%= url.redirectUrl %></td>
              <td><%= url.visitHistory.length %></td>
              <td>
                <form
                  action="/url/del/<%=url.shortId%>"
                  method="POST"
                  style="display: inline"
                >
                  <input type="hidden" name="_method" value="DELETE" />
                  <button type="submit" class="btn btn-danger btn-sm">
                    Delete
                  </button>
                </form>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
      <% } %> <% if (locals.all_urls && locals.all_urls.length) { %>
      <div class="table-responsive">
        <div class="table-title">Public URLs</div>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>S. No</th>
              <th>Short ID</th>
              <th>Redirect URL</th>
              <th>Clicks</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% all_urls.forEach((url, index) => { %>
            <tr>
              <td><%= index + 1 %></td>
              <td><%= url.shortId %></td>
              <td><%= url.redirectUrl %></td>
              <td><%= url.visitHistory.length %></td>
              <td>
                <a
                  href="/url/<%= url.shortId %>"
                  target="_blank"
                  class="btn btn-primary btn-sm"
                  >Visit</a
                >
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
      <% } %>
    </div>

    <% if ((!locals.my_urls || locals.my_urls.length === 0) && (!locals.all_urls
    || locals.all_urls.length === 0)) { %>
    <div class="alert alert-info text-center">No URLs Found</div>
    <% } %>
  </body>
</html>
